<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>å‰è¨€ | longgerä¸ªäººåšå®¢</title>
    <meta name="description" content="Personal Website">
    <link rel="icon" href="/images/photo.jpg">
  <link rel="manifest" href="/images/photo.jpg">
  <link rel="apple-touch-icon" href="/images/photo.jpg">
  <meta http-quiv="pragma" cotent="no-cache">
  <meta http-quiv="pragma" cotent="no-cache,must-revalidate">
  <meta http-quiv="expires" cotent="0">
    
    <link rel="preload" href="/assets/css/0.styles.47c0e538.css" as="style"><link rel="preload" href="/assets/js/app.ddf169d8.js" as="script"><link rel="preload" href="/assets/js/10.cf1bc230.js" as="script"><link rel="prefetch" href="/assets/js/11.2f5262be.js"><link rel="prefetch" href="/assets/js/12.763b28b8.js"><link rel="prefetch" href="/assets/js/13.9640c310.js"><link rel="prefetch" href="/assets/js/14.6a6b2539.js"><link rel="prefetch" href="/assets/js/15.c91f14b9.js"><link rel="prefetch" href="/assets/js/16.8f7dfb98.js"><link rel="prefetch" href="/assets/js/17.16f901e2.js"><link rel="prefetch" href="/assets/js/18.df3d5f02.js"><link rel="prefetch" href="/assets/js/19.cc75ce38.js"><link rel="prefetch" href="/assets/js/2.81770428.js"><link rel="prefetch" href="/assets/js/20.f365b100.js"><link rel="prefetch" href="/assets/js/21.64605176.js"><link rel="prefetch" href="/assets/js/22.cf712662.js"><link rel="prefetch" href="/assets/js/23.0c81b9b2.js"><link rel="prefetch" href="/assets/js/24.39e614db.js"><link rel="prefetch" href="/assets/js/25.7fe0f933.js"><link rel="prefetch" href="/assets/js/26.a9222ed5.js"><link rel="prefetch" href="/assets/js/27.eb522861.js"><link rel="prefetch" href="/assets/js/28.5b4d4f28.js"><link rel="prefetch" href="/assets/js/29.1e90c05c.js"><link rel="prefetch" href="/assets/js/3.e75cae9a.js"><link rel="prefetch" href="/assets/js/30.ecc167b6.js"><link rel="prefetch" href="/assets/js/31.6b1a5bbc.js"><link rel="prefetch" href="/assets/js/32.52bce39c.js"><link rel="prefetch" href="/assets/js/33.208f971b.js"><link rel="prefetch" href="/assets/js/4.20ce77fb.js"><link rel="prefetch" href="/assets/js/5.5920e34d.js"><link rel="prefetch" href="/assets/js/6.224dfbe4.js"><link rel="prefetch" href="/assets/js/7.d6765f0d.js"><link rel="prefetch" href="/assets/js/8.a144f217.js"><link rel="prefetch" href="/assets/js/9.b9252c8f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.47c0e538.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">longgerä¸ªäººåšå®¢</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><a href="/accumulate/git/handleGit.html" class="nav-link">å‰ç«¯</a></div><div class="nav-item"><a href="/baseComponents/Layout/basicLayout.html" class="nav-link">ç»„ä»¶æ–‡æ¡£</a></div><div class="nav-item"><a href="/others/" class="nav-link">è¯—å’Œè¿œæ–¹</a></div><div class="nav-item"><a href="https://www.runoob.com/markdown/md-tutorial.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Markdown æ•™ç¨‹
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><a href="/accumulate/git/handleGit.html" class="nav-link">å‰ç«¯</a></div><div class="nav-item"><a href="/baseComponents/Layout/basicLayout.html" class="nav-link">ç»„ä»¶æ–‡æ¡£</a></div><div class="nav-item"><a href="/others/" class="nav-link">è¯—å’Œè¿œæ–¹</a></div><div class="nav-item"><a href="https://www.runoob.com/markdown/md-tutorial.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Markdown æ•™ç¨‹
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>git</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>JSé«˜çº§</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/accumulate/JS/Tools.html" class="sidebar-link">JSå¼€å‘å¸¸ç”¨å·¥å…·å‡½æ•°</a></li><li><a href="/accumulate/JS/A001.html" class="sidebar-link">Javascriptæ‰§è¡Œæœºåˆ¶</a></li><li><a href="/accumulate/JS/A002.html" class="sidebar-link">ES6å’ŒES5çš„å¯¹æ¯”</a></li><li><a href="/accumulate/JS/A003.html" class="sidebar-link">Express çš„ä½¿ç”¨</a></li><li><a href="/accumulate/JS/A004.html" class="active sidebar-link">åˆå­¦ Babel å·¥ä½œåŸç†</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/accumulate/JS/A004.html#å‰è¨€" class="sidebar-link">å‰è¨€</a></li><li class="sidebar-sub-header"><a href="/accumulate/JS/A004.html#whatï¼šä»€ä¹ˆæ˜¯-babel" class="sidebar-link">Whatï¼šä»€ä¹ˆæ˜¯ Babel</a></li><li class="sidebar-sub-header"><a href="/accumulate/JS/A004.html#how-babel-æ˜¯å¦‚ä½•å·¥ä½œçš„" class="sidebar-link">How: Babel æ˜¯å¦‚ä½•å·¥ä½œçš„</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/accumulate/JS/A004.html#ast" class="sidebar-link">AST</a></li><li class="sidebar-sub-header"><a href="/accumulate/JS/A004.html#babel-å·¥ä½œè¿‡ç¨‹" class="sidebar-link">Babel å·¥ä½œè¿‡ç¨‹</a></li><li class="sidebar-sub-header"><a href="/accumulate/JS/A004.html#parseï¼ˆè§£æï¼‰" class="sidebar-link">Parseï¼ˆè§£æï¼‰</a></li><li class="sidebar-sub-header"><a href="/accumulate/JS/A004.html#visitor" class="sidebar-link">Visitor</a></li><li class="sidebar-sub-header"><a href="/accumulate/JS/A004.html#generate-ä»£ç ç”Ÿæˆ" class="sidebar-link">Generate(ä»£ç ç”Ÿæˆ)</a></li></ul></li><li class="sidebar-sub-header"><a href="/accumulate/JS/A004.html#å‚è€ƒé“¾æ¥" class="sidebar-link">å‚è€ƒé“¾æ¥</a></li></ul></li><li><a href="/accumulate/JS/A005.html" class="sidebar-link">javascriptä¸­çš„å…­ç§ç»§æ‰¿æ–¹å¼</a></li><li><a href="/accumulate/JS/A006.html" class="sidebar-link">javascriptä¸­çš„é˜²æŠ–èŠ‚æµ</a></li><li><a href="/accumulate/JS/A007.html" class="sidebar-link">javascriptä¸­çš„æ–‡ä»¶å¯¼å‡ºåŠŸèƒ½</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>vueç¬”è®°</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Openlayersç¬”è®°</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h2 id="å‰è¨€"><a href="#å‰è¨€" aria-hidden="true" class="header-anchor">#</a> å‰è¨€</h2> <p>Babel å¯¹äºå‰ç«¯å¼€å‘è€…æ¥è¯´åº”è¯¥æ˜¯å¾ˆç†Ÿæ‚‰äº†ï¼Œæ—¥å¸¸å¼€å‘ä¸­åŸºæœ¬ä¸Šæ˜¯ç¦»ä¸å¼€å®ƒçš„ã€‚</p> <p>å·²ç»9102äº†ï¼Œæˆ‘ä»¬å·²ç»èƒ½å¤Ÿç†Ÿç»ƒåœ°ä½¿ç”¨ es2015+ çš„è¯­æ³•ã€‚ä½†æ˜¯å¯¹äºæµè§ˆå™¨æ¥è¯´ï¼Œå¯èƒ½å’Œå®ƒä»¬è¿˜ä¸å¤Ÿç†Ÿæ‚‰ï¼Œæˆ‘ä»¬å¾—è®©æµè§ˆå™¨ç†è§£å®ƒä»¬ï¼Œè¿™å°±éœ€è¦ Babelã€‚</p> <p>å½“ç„¶ï¼Œä»…ä»…æ˜¯ Babel æ˜¯ä¸å¤Ÿçš„ï¼Œè¿˜éœ€è¦ polyfill ç­‰ç­‰ç­‰ç­‰ï¼Œè¿™é‡Œå°±å…ˆä¸è¯´äº†ã€‚</p> <h2 id="whatï¼šä»€ä¹ˆæ˜¯-babel"><a href="#whatï¼šä»€ä¹ˆæ˜¯-babel" aria-hidden="true" class="header-anchor">#</a> Whatï¼šä»€ä¹ˆæ˜¯ Babel</h2> <div class="tip custom-block"><p class="custom-block-title">æç¤º</p> <p>Babel is a toolchain that is mainly used to convert ECMAScript 2015+ code into a backwards compatible version of JavaScript in current and older browsers or environments.</p></div> <p>ç®€å•åœ°è¯´ï¼ŒBabel èƒ½å¤Ÿè½¬è¯‘ ECMAScript 2015+ çš„ä»£ç ï¼Œä½¿å®ƒåœ¨æ—§çš„æµè§ˆå™¨æˆ–è€…ç¯å¢ƒä¸­ä¹Ÿèƒ½å¤Ÿè¿è¡Œã€‚</p> <p>æˆ‘ä»¬å¯ä»¥åœ¨ https://babel.docschina.org/repl å°è¯•ä¸€ä¸‹ã€‚</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// es2015 çš„ const å’Œ arrow function</span>
<span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>

<span class="token comment">// Babel è½¬è¯‘å</span>
<span class="token keyword">var</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Babel çš„åŠŸèƒ½å¾ˆçº¯ç²¹ã€‚æˆ‘ä»¬ä¼ é€’ä¸€æ®µæºä»£ç ç»™ Babelï¼Œç„¶åå®ƒè¿”å›ä¸€ä¸²æ–°çš„ä»£ç ç»™æˆ‘ä»¬ã€‚å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œå®ƒä¸ä¼šè¿è¡Œæˆ‘ä»¬çš„ä»£ç ï¼Œä¹Ÿä¸ä¼šå»æ‰“åŒ…æˆ‘ä»¬çš„ä»£ç ã€‚</p> <p>å®ƒåªæ˜¯ä¸€ä¸ªç¼–è¯‘å™¨ã€‚</p> <h2 id="how-babel-æ˜¯å¦‚ä½•å·¥ä½œçš„"><a href="#how-babel-æ˜¯å¦‚ä½•å·¥ä½œçš„" aria-hidden="true" class="header-anchor">#</a> How: Babel æ˜¯å¦‚ä½•å·¥ä½œçš„</h2> <p>é¦–å…ˆå¾—è¦å…ˆäº†è§£ä¸€ä¸ªæ¦‚å¿µï¼šæŠ½è±¡è¯­æ³•æ ‘ï¼ˆAbstract Syntax Tree, ASTï¼‰ï¼ŒBabel æœ¬è´¨ä¸Šå°±æ˜¯åœ¨æ“ä½œ AST æ¥å®Œæˆä»£ç çš„è½¬è¯‘ã€‚</p> <h3 id="ast"><a href="#ast" aria-hidden="true" class="header-anchor">#</a> AST</h3> <p>AST æ˜¯ä»€ä¹ˆè¿™é‡Œå°±ä¸ç»†è¯´äº†ï¼Œæƒ³è¦äº†è§£æ›´å¤šä¿¡æ¯å¯ä»¥æŸ¥çœ‹ Abstract syntax tree - Wikipediaã€‚</p> <p>è¿™é‡Œæ¯”è¾ƒå…³å¿ƒçš„ä¸€æ®µ JavaScript ä»£ç ä¼šç”Ÿæˆä¸€ä¸ªæ€æ ·çš„ ASTï¼ŒBabel åˆæ˜¯æ€ä¹ˆå»æ“ä½œ AST çš„ã€‚</p> <p>æˆ‘ä»¬è¿˜æ˜¯æ‹¿ä¸Šé¢çš„ğŸŒ°æ¥è¯´æ˜ const add = (a, b) =&gt; a + b;ï¼Œè¿™æ ·ä¸€å¥ç®€å•çš„ä»£ç ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å®ƒç”Ÿæˆçš„ AST ä¼šæ˜¯æ€æ ·çš„ï¼š</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Program&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;body&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;VariableDeclaration&quot;</span><span class="token punctuation">,</span> <span class="token comment">// å˜é‡å£°æ˜</span>
      <span class="token property">&quot;declarations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// å…·ä½“å£°æ˜</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;VariableDeclarator&quot;</span><span class="token punctuation">,</span> <span class="token comment">// å˜é‡å£°æ˜</span>
          <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span> <span class="token comment">// æ ‡è¯†ç¬¦ï¼ˆæœ€åŸºç¡€çš„ï¼‰</span>
            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;add&quot;</span> <span class="token comment">// å‡½æ•°å</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">&quot;init&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ArrowFunctionExpression&quot;</span><span class="token punctuation">,</span> <span class="token comment">// ç®­å¤´å‡½æ•°</span>
            <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">&quot;expression&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token property">&quot;generator&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token property">&quot;params&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// å‚æ•°</span>
              <span class="token punctuation">{</span>
                <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;a&quot;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">{</span>
                <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;b&quot;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;body&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// å‡½æ•°ä½“</span>
              <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;BinaryExpression&quot;</span><span class="token punctuation">,</span> <span class="token comment">// äºŒé¡¹å¼</span>
              <span class="token property">&quot;left&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// äºŒé¡¹å¼å·¦è¾¹</span>
                <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;a&quot;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token property">&quot;operator&quot;</span><span class="token operator">:</span> <span class="token string">&quot;+&quot;</span><span class="token punctuation">,</span> <span class="token comment">// äºŒé¡¹å¼è¿ç®—ç¬¦</span>
              <span class="token property">&quot;right&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// äºŒé¡¹å¼å³è¾¹</span>
                <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;b&quot;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">&quot;kind&quot;</span><span class="token operator">:</span> <span class="token string">&quot;const&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;sourceType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;module&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€æ£µâ€œæ ‘â€æ¥æ›´ä¸ºç›´è§‚åœ°å±•ç¤ºè¿™å¥ä»£ç çš„ AST(ä»ç¬¬äºŒå±‚çš„ declarations å¼€å§‹)ï¼š
ä¸€ä¸ªVariableDeclaration(å˜é‡å£°æ˜)ï¼šå£°æ˜äº†ä¸€ä¸ª name ä¸º add çš„ArrowFunctionExpression(ç®­å¤´å‡½æ•°)ï¼š</p> <ul><li><p>params(å‡½æ•°å…¥å‚)ï¼ša å’Œ b</p></li> <li><p>å‡½æ•°ä½“ï¼šå‡½æ•°ä¸»ä½“æ˜¯ä¸€ä¸ªBinaryExpression (äºŒé¡¹å¼)ï¼Œä¸€ä¸ªæ ‡å‡†çš„äºŒé¡¹å¼åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š</p> <ul><li>left(å·¦è¾¹)ï¼ša</li> <li>operator(è¿ç®—ç¬¦)ï¼šåŠ å· +</li> <li>right(å³è¾¹)ï¼šb
è¿™æ ·å°±æ‹†è§£äº†è¿™ä¸€è¡Œä»£ç ã€‚</li></ul></li></ul> <p>å¦‚æœæƒ³è¦äº†è§£æ›´å¤šï¼Œå¯ä»¥é˜…è¯»å’Œå°è¯•ï¼š</p> <ul><li>åˆ†æ ASTï¼šhttps://ASTexplorer.net</li> <li>AST è§„èŒƒï¼šhttps://github.com/estree/estree</li></ul> <h3 id="babel-å·¥ä½œè¿‡ç¨‹"><a href="#babel-å·¥ä½œè¿‡ç¨‹" aria-hidden="true" class="header-anchor">#</a> Babel å·¥ä½œè¿‡ç¨‹</h3> <p>äº†è§£äº† AST æ˜¯ä»€ä¹ˆæ ·çš„ï¼Œå°±å¯ä»¥å¼€å§‹ç ”ç©¶ Babel çš„å·¥ä½œè¿‡ç¨‹äº†ã€‚</p> <p>ä¸Šé¢è¯´è¿‡ï¼ŒBabel çš„åŠŸèƒ½å¾ˆçº¯ç²¹ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªç¼–è¯‘å™¨ã€‚</p> <p>å¤§å¤šæ•°ç¼–è¯‘å™¨çš„å·¥ä½œè¿‡ç¨‹å¯ä»¥åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š</p> <ol><li><strong>Parse(è§£æ)</strong>ï¼šå°†æºä»£ç è½¬æ¢æˆæ›´åŠ æŠ½è±¡çš„è¡¨ç¤ºæ–¹æ³•ï¼ˆä¾‹å¦‚æŠ½è±¡è¯­æ³•æ ‘ï¼‰</li> <li><strong>Transform(è½¬æ¢)</strong>ï¼šå¯¹ï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰åšä¸€äº›ç‰¹æ®Šå¤„ç†ï¼Œè®©å®ƒç¬¦åˆç¼–è¯‘å™¨çš„æœŸæœ›</li> <li><strong>Generate(ä»£ç ç”Ÿæˆ)</strong>ï¼šå°†ç¬¬äºŒæ­¥ç»è¿‡è½¬æ¢è¿‡çš„ï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰ç”Ÿæˆæ–°çš„ä»£ç </li></ol> <p>å—¯... æ—¢ç„¶ Babel æ˜¯ä¸€ä¸ªç¼–è¯‘å™¨ï¼Œå½“ç„¶å®ƒçš„å·¥ä½œè¿‡ç¨‹ä¹Ÿæ˜¯è¿™æ ·çš„ã€‚æˆ‘ä»¬æ¥ä»”ç»†çœ‹çœ‹è¿™ä¸‰æ­¥åˆ†åˆ«åšäº†ä»€ä¹ˆäº‹ã€‚å½“ç„¶ï¼Œè¿˜æ˜¯æ‹¿ä¸Šé¢çš„ğŸŒ°æ¥è¯´æ˜ const add = (a, b) =&gt; a + bï¼Œçœ‹çœ‹å®ƒæ˜¯å¦‚ä½•ç»è¿‡ Babel å˜æˆï¼š</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="parseï¼ˆè§£æï¼‰"><a href="#parseï¼ˆè§£æï¼‰" aria-hidden="true" class="header-anchor">#</a> Parseï¼ˆè§£æï¼‰</h3> <p>ä¸€èˆ¬æ¥è¯´ï¼ŒParse é˜¶æ®µå¯ä»¥ç»†åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šè¯æ³•åˆ†æï¼ˆLexical Analysis, LAï¼‰å’Œè¯­æ³•åˆ†æï¼ˆSyntactic Analysis, SAï¼‰ã€‚</p> <p>è¯æ³•åˆ†æ
è¯æ³•åˆ†æé˜¶æ®µå¯ä»¥çœ‹æˆæ˜¯å¯¹ä»£ç è¿›è¡Œâ€œåˆ†è¯â€ï¼Œå®ƒæ¥æ”¶ä¸€æ®µæºä»£ç ï¼Œç„¶åæ‰§è¡Œä¸€æ®µ tokenize å‡½æ•°ï¼ŒæŠŠä»£ç åˆ†å‰²æˆè¢«ç§°ä¸ºTokens çš„ä¸œè¥¿ã€‚Tokens æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç”±ä¸€äº›ä»£ç çš„ç¢ç‰‡ç»„æˆï¼Œæ¯”å¦‚æ•°å­—ã€æ ‡ç‚¹ç¬¦å·ã€è¿ç®—ç¬¦å·ç­‰ç­‰ç­‰ç­‰ï¼Œä¾‹å¦‚è¿™æ ·ï¼š</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">[</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Keyword&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;const&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;add&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Punctuator&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;=&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Punctuator&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;(&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;a&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Punctuator&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;,&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;b&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Punctuator&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;)&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Punctuator&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;=&gt;&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;a&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Punctuator&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;+&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;b&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>é€šè¿‡ http://esprima.org/demo/parse.html ç”Ÿæˆçš„ã€‚</p> <p>çœ‹ä¸Šå»å¥½åƒå¾ˆå®¹æ˜“å•Šï¼Œå°±æ˜¯æŠŠä¸€å¥å®Œæ•´çš„ä»£ç æ‹†æˆä¸€ä¸ªä¸ªç‹¬ç«‹ä¸ªä½“å°±å¥½äº†ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¾—è®©æœºå™¨çŸ¥é“æ€ä¹ˆæ‹†~</p> <p>æˆ‘ä»¬æ¥è¯•ç€å®ç°ä¸€ä¸‹ tokenize å‡½æ•°ï¼š</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * è¯æ³•åˆ†æ tokenize
 * @param {string} code JavaScript ä»£ç 
 * @return {Array} token
 */</span>
<span class="token keyword">function</span> <span class="token function">tokenize</span><span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>code <span class="token operator">||</span> code<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> current <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// è®°å½•ä½ç½®</span>
    <span class="token keyword">var</span> tokens <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// å®šä¹‰ä¸€ä¸ªç©ºçš„ token æ•°ç»„</span>

    <span class="token keyword">var</span> <span class="token constant">LETTERS</span> <span class="token operator">=</span> <span class="token regex">/[a-zA-Z\$\_]/i</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> <span class="token constant">KEYWORDS</span> <span class="token operator">=</span> <span class="token regex">/const/</span><span class="token punctuation">;</span> <span class="token comment">//  æ¨¡æ‹Ÿä¸€ä¸‹åˆ¤æ–­æ˜¯ä¸æ˜¯å…³é”®å­—</span>
    <span class="token keyword">var</span> <span class="token constant">WHITESPACE</span> <span class="token operator">=</span> <span class="token regex">/\s/</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> <span class="token constant">PARENS</span> <span class="token operator">=</span> <span class="token regex">/\(|\)/</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> <span class="token constant">NUMBERS</span> <span class="token operator">=</span> <span class="token regex">/[0-9]/</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> <span class="token constant">OPERATORS</span> <span class="token operator">=</span> <span class="token regex">/[+*/-]/</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> <span class="token constant">PUNCTUATORS</span> <span class="token operator">=</span> <span class="token regex">/[~!@#$%^&amp;*()/\|,.&lt;&gt;?&quot;';:_+-=\[\]{}]/</span><span class="token punctuation">;</span>

    <span class="token comment">// ä»ç¬¬ä¸€ä¸ªå­—ç¬¦å¼€å§‹éå†</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>current <span class="token operator">&lt;</span> code<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> char <span class="token operator">=</span> code<span class="token punctuation">[</span>current<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆ¤æ–­ç©ºæ ¼</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">WHITESPACE</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          current<span class="token operator">++</span><span class="token punctuation">;</span>
          <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// åˆ¤æ–­è¿ç»­å­—ç¬¦</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">LETTERS</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> type <span class="token operator">=</span> <span class="token string">'Identifier'</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>char <span class="token operator">&amp;&amp;</span> <span class="token constant">LETTERS</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                value <span class="token operator">+=</span> char<span class="token punctuation">;</span>
                char <span class="token operator">=</span> code<span class="token punctuation">[</span><span class="token operator">++</span>current<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// åˆ¤æ–­æ˜¯å¦æ˜¯å…³é”®å­—</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">KEYWORDS</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                type <span class="token operator">=</span> <span class="token string">'Keyword'</span>
            <span class="token punctuation">}</span>
            tokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                type<span class="token punctuation">:</span> type<span class="token punctuation">,</span>
                value<span class="token punctuation">:</span> value
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// åˆ¤æ–­å°æ‹¬å·</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">PARENS</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            tokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              type<span class="token punctuation">:</span> <span class="token string">'Paren'</span><span class="token punctuation">,</span>
              value<span class="token punctuation">:</span> char
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            current<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// åˆ¤æ–­è¿ç»­æ•°å­—</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NUMBERS</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
          <span class="token keyword">while</span> <span class="token punctuation">(</span>char <span class="token operator">&amp;&amp;</span> <span class="token constant">NUMBERS</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            value <span class="token operator">+=</span> char<span class="token punctuation">;</span>
            char <span class="token operator">=</span> code<span class="token punctuation">[</span><span class="token operator">++</span>current<span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          tokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            type<span class="token punctuation">:</span> <span class="token string">'Number'</span><span class="token punctuation">,</span>
            value<span class="token punctuation">:</span> value
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// åˆ¤æ–­è¿ç®—ç¬¦</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">OPERATORS</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            tokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                type<span class="token punctuation">:</span> <span class="token string">'Operator'</span><span class="token punctuation">,</span>
                value<span class="token punctuation">:</span> char
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            current<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// åˆ¤æ–­ç®­å¤´å‡½æ•°</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">PUNCTUATORS</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> value <span class="token operator">=</span> char<span class="token punctuation">;</span>
            <span class="token keyword">var</span> type <span class="token operator">=</span> <span class="token string">'Punctuator'</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> temp <span class="token operator">=</span> code<span class="token punctuation">[</span><span class="token operator">++</span>current<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>temp <span class="token operator">===</span> <span class="token string">'&gt;'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                type <span class="token operator">=</span> <span class="token string">'ArrowFunction'</span><span class="token punctuation">;</span>
                value <span class="token operator">+=</span> temp<span class="token punctuation">;</span>
                current <span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            tokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                type<span class="token punctuation">:</span> type<span class="token punctuation">,</span>
                value<span class="token punctuation">:</span> value
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        tokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            type<span class="token punctuation">:</span> <span class="token string">'Identifier'</span><span class="token punctuation">,</span>
            value<span class="token punctuation">:</span> char
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        current<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> tokens<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br></div></div><p>ä¸Šé¢è¿™ä¸ª tokenize å‡½æ•°åªæ˜¯è‡ªå·±å®ç°ä»¥ä¸‹ï¼Œä¸å®é™…ä¸Š Babel çš„å®ç°æ–¹å¼è¿˜æ˜¯å·®ä¸å°‘çš„ï¼Œå¦‚æœæ„Ÿå…´è¶£å¯ä»¥çœ‹çœ‹https://github.com/babel/babel/blob/master/packages/babel-parser/src/tokenizer</p> <p>æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼š</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> tokens <span class="token operator">=</span> <span class="token function">tokenize</span><span class="token punctuation">(</span><span class="token string">'const add = (a, b) =&gt; a + b'</span><span class="token punctuation">)</span>ï¼›
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tokens<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Keyword&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;const&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;add&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Punctuator&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;=&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Paren&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;(&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;a&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Punctuator&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;,&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;b&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Paren&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;)&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;ArrowFunction&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;=&gt;&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;a&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Operator&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;+&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;b&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>çœ‹ä¸Šå»å’Œä¸Šé¢çš„æœ‰ç‚¹ä¸å¤ªä¸€æ ·ï¼Œæ²¡å…³ç³»ï¼Œæˆ‘åªæ˜¯ç»†åŒ–äº†ä¸€ä¸‹ç±»åˆ«ï¼Œæ„æ€å°±æ˜¯è¿™ä¹ˆä¸ªæ„æ€ã€‚</p> <p>è¯­æ³•åˆ†æ
è¯æ³•åˆ†æä¹‹åï¼Œä»£ç å°±å·²ç»å˜æˆäº†ä¸€ä¸ª Tokens æ•°ç»„äº†ï¼Œç°åœ¨éœ€è¦é€šè¿‡è¯­æ³•åˆ†ææŠŠ Tokens è½¬åŒ–ä¸ºä¸Šé¢æåˆ°è¿‡çš„ ASTã€‚</p> <p>è¯´æ¥æƒ­æ„§ï¼Œè¿™é‡Œæ²¡æœ‰æƒ³åˆ°å¾ˆå¥½çš„æ€è·¯æ¥å®ç°ä¸€ä¸ª parse å‡½æ•°ã€‚å¦‚æœå“ªå¤©æƒ³åˆ°äº†ï¼Œå†è¡¥å……ä¸Šæ¥ã€‚</p> <p>ç°åœ¨æˆ‘ä»¬å…ˆå‡è®¾å·²ç»å®ç°äº†è¿™æ ·ä¸€ä¸ªå‡½æ•°ï¼ŒæŠŠä¸Šé¢çš„ Tokens è½¬åŒ–æˆäº†ä¸€ä¸ª ASTï¼Œè¿›å…¥ä¸‹ä¸€æ­¥ã€‚</p> <p>å¦‚æœæ„Ÿå…´è¶£å¯ä»¥çœ‹çœ‹å®˜æ–¹çš„åšæ³•https://github.com/babel/babel/tree/master/packages/babel-parser/src/parser</p> <p>Transform(è½¬æ¢)
è¿™ä¸€æ­¥åšçš„äº‹æƒ…ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯æ“ä½œ ASTã€‚å¦‚æœå¿˜è®°äº† AST æ˜¯ä»€ä¹ˆï¼Œå¯ä»¥å›åˆ°ä¸Šé¢å†çœ‹çœ‹ã€‚</p> <p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° AST ä¸­æœ‰å¾ˆå¤šç›¸ä¼¼çš„å…ƒç´ ï¼Œå®ƒä»¬éƒ½æœ‰ä¸€ä¸ª type å±æ€§ï¼Œè¿™æ ·çš„å…ƒç´ è¢«ç§°ä½œèŠ‚ç‚¹ã€‚ä¸€ä¸ªèŠ‚ç‚¹é€šå¸¸å«æœ‰è‹¥å¹²å±æ€§ï¼Œå¯ä»¥ç”¨äºæè¿° AST çš„éƒ¨åˆ†ä¿¡æ¯ã€‚</p> <p>æ¯”å¦‚è¿™æ˜¯ä¸€ä¸ªæœ€å¸¸è§çš„ Identifier èŠ‚ç‚¹ï¼š</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> <span class="token string">'Identifier'</span><span class="token punctuation">,</span>
    name<span class="token punctuation">:</span> <span class="token string">'add'</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦ã€‚</p> <p>æ‰€ä»¥ï¼Œæ“ä½œ AST ä¹Ÿå°±æ˜¯æ“ä½œå…¶ä¸­çš„èŠ‚ç‚¹ï¼Œå¯ä»¥å¢åˆ æ”¹è¿™äº›èŠ‚ç‚¹ï¼Œä»è€Œè½¬æ¢æˆå®é™…éœ€è¦çš„ ASTã€‚</p> <p>æ›´å¤šçš„èŠ‚ç‚¹è§„èŒƒå¯ä»¥åœ¨https://github.com/estree/estreeä¸­æŸ¥çœ‹ã€‚</p> <p>Babel å¯¹äº AST çš„éå†æ˜¯æ·±åº¦ä¼˜å…ˆéå†ï¼Œå¯¹äº AST ä¸Šçš„æ¯ä¸€ä¸ªåˆ†æ”¯ Babel éƒ½ä¼šå…ˆå‘ä¸‹éå†èµ°åˆ°å°½å¤´ï¼Œç„¶åå†å‘ä¸Šéå†é€€å‡ºåˆšéå†è¿‡çš„èŠ‚ç‚¹ï¼Œç„¶åå¯»æ‰¾ä¸‹ä¸€ä¸ªåˆ†æ”¯ã€‚</p> <p>è¿˜æ˜¯ä¸Šé¢çš„ğŸŒ°ï¼š</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Program&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;body&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;VariableDeclaration&quot;</span><span class="token punctuation">,</span> <span class="token comment">// å˜é‡å£°æ˜</span>
      <span class="token property">&quot;declarations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// å…·ä½“å£°æ˜</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;VariableDeclarator&quot;</span><span class="token punctuation">,</span> <span class="token comment">// å˜é‡å£°æ˜</span>
          <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span> <span class="token comment">// æ ‡è¯†ç¬¦ï¼ˆæœ€åŸºç¡€çš„ï¼‰</span>
            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;add&quot;</span> <span class="token comment">// å‡½æ•°å</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">&quot;init&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ArrowFunctionExpression&quot;</span><span class="token punctuation">,</span> <span class="token comment">// ç®­å¤´å‡½æ•°</span>
            <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">&quot;expression&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token property">&quot;generator&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token property">&quot;params&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// å‚æ•°</span>
              <span class="token punctuation">{</span>
                <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;a&quot;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">{</span>
                <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;b&quot;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;body&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// å‡½æ•°ä½“</span>
              <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;BinaryExpression&quot;</span><span class="token punctuation">,</span> <span class="token comment">// äºŒé¡¹å¼</span>
              <span class="token property">&quot;left&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// äºŒé¡¹å¼å·¦è¾¹</span>
                <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;a&quot;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token property">&quot;operator&quot;</span><span class="token operator">:</span> <span class="token string">&quot;+&quot;</span><span class="token punctuation">,</span> <span class="token comment">// äºŒé¡¹å¼è¿ç®—ç¬¦</span>
              <span class="token property">&quot;right&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// äºŒé¡¹å¼å³è¾¹</span>
                <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;b&quot;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">&quot;kind&quot;</span><span class="token operator">:</span> <span class="token string">&quot;const&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;sourceType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;module&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><p>æ ¹èŠ‚ç‚¹æˆ‘ä»¬å°±ä¸è¯´äº†ï¼Œä» declarations é‡Œå¼€å§‹éå†ï¼š</p> <ol><li><p>å£°æ˜äº†ä¸€ä¸ªå˜é‡ï¼Œå¹¶ä¸”çŸ¥é“äº†å®ƒçš„å†…éƒ¨å±æ€§ï¼ˆidã€initï¼‰ï¼Œç„¶åæˆ‘ä»¬å†ä»¥æ­¤è®¿é—®æ¯ä¸€ä¸ªå±æ€§ä»¥åŠå®ƒä»¬çš„å­èŠ‚ç‚¹ã€‚</p></li> <li><p>id æ˜¯ä¸€ä¸ª Idenrifierï¼Œæœ‰ä¸€ä¸ª name å±æ€§è¡¨ç¤ºå˜é‡åã€‚</p></li> <li><p>ä¹‹åæ˜¯ initï¼Œinit ä¹Ÿæœ‰å¥½å‡ ä¸ªå†…éƒ¨å±æ€§ï¼š</p> <ul><li>type æ˜¯ArrowFunctionExpressionï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªç®­å¤´å‡½æ•°è¡¨è¾¾å¼</li> <li>params æ˜¯è¿™ä¸ªç®­å¤´å‡½æ•°çš„å…¥å‚ï¼Œå…¶ä¸­æ¯ä¸€ä¸ªå‚æ•°éƒ½æ˜¯ä¸€ä¸ª Identifier ç±»å‹çš„èŠ‚ç‚¹ï¼›</li> <li>body å±æ€§æ˜¯è¿™ä¸ªç®­å¤´å‡½æ•°çš„ä¸»ä½“ï¼Œè¿™æ˜¯ä¸€ä¸ª BinaryExpression äºŒé¡¹å¼ï¼šleftã€operatorã€rightï¼Œåˆ†åˆ«è¡¨ç¤ºäºŒé¡¹å¼çš„å·¦è¾¹å˜é‡ã€è¿ç®—ç¬¦ä»¥åŠå³è¾¹å˜é‡ã€‚</li></ul></li></ol> <p>è¿™æ˜¯éå† AST çš„ç™½è¯å½¢å¼ï¼Œå†çœ‹çœ‹ Babel æ˜¯æ€ä¹ˆåšçš„ï¼š</p> <p>Babel ä¼šç»´æŠ¤ä¸€ä¸ªç§°ä½œ Visitor çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å®šä¹‰äº†ç”¨äº AST ä¸­è·å–å…·ä½“èŠ‚ç‚¹çš„æ–¹æ³•ã€‚</p> <h3 id="visitor"><a href="#visitor" aria-hidden="true" class="header-anchor">#</a> Visitor</h3> <p>ä¸€ä¸ª Visitor ä¸€èˆ¬æ¥è¯´æ˜¯è¿™æ ·çš„ï¼š</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> visitor <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function">ArrowFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æˆ‘æ˜¯ç®­å¤´å‡½æ•°'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">IfStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æˆ‘æ˜¯ä¸€ä¸ªifè¯­å¥'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">CallExpression</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>å½“æˆ‘ä»¬éå† AST çš„æ—¶å€™ï¼Œå¦‚æœåŒ¹é…ä¸Šä¸€ä¸ª typeï¼Œå°±ä¼šè°ƒç”¨ visitor é‡Œçš„æ–¹æ³•ã€‚</p> <p>è¿™åªæ˜¯ä¸€ä¸ªç®€å•çš„ Visitor ã€‚</p> <p>ä¸Šé¢è¯´è¿‡ï¼ŒBabel éå† AST å…¶å®ä¼šç»è¿‡ä¸¤æ¬¡èŠ‚ç‚¹ï¼šéå†çš„æ—¶å€™å’Œé€€å‡ºçš„æ—¶å€™ï¼Œæ‰€ä»¥å®é™…ä¸Š Babel ä¸­çš„ Visitor åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> visitor <span class="token operator">=</span> <span class="token punctuation">{</span>
    Identifier<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Identifier enter'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Identifier exit'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>æ¯”å¦‚æˆ‘ä»¬æ‹¿è¿™ä¸ª visitor æ¥éå†è¿™æ ·ä¸€ä¸ª ASTï¼š</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>params<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// å‚æ•°</span>
    <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;a&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;b&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>è¿‡ç¨‹å¯èƒ½æ˜¯è¿™æ ·çš„...</p> <ul><li>è¿›å…¥ Identifier(params[0])</li> <li>èµ°åˆ°å°½å¤´</li> <li>é€€å‡º Identifier(params[0])</li> <li>è¿›å…¥ Identifier(params[1])</li> <li>èµ°åˆ°å°½å¤´</li> <li>é€€å‡º Identifier(params[1])</li></ul> <p>å½“ç„¶ï¼ŒBabel ä¸­çš„ Visitor æ¨¡å¼è¿œè¿œæ¯”è¿™å¤æ‚...</p> <p>å›åˆ°ä¸Šé¢çš„ğŸŒ°ï¼Œç®­å¤´å‡½æ•°æ˜¯ ES5 ä¸æ”¯æŒçš„è¯­æ³•ï¼Œæ‰€ä»¥ Babel å¾—æŠŠå®ƒè½¬æ¢æˆæ™®é€šå‡½æ•°ï¼Œä¸€å±‚å±‚éå†ä¸‹å»ï¼Œæ‰¾åˆ°äº† ArrowFunctionExpression èŠ‚ç‚¹ï¼Œè¿™æ—¶å€™å°±éœ€è¦æŠŠå®ƒæ›¿æ¢æˆ FunctionDeclaration èŠ‚ç‚¹ã€‚æ‰€ä»¥ï¼Œç®­å¤´å‡½æ•°å¯èƒ½æ˜¯è¿™æ ·å¤„ç†çš„ï¼š</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> t <span class="token keyword">from</span> <span class="token string">&quot;@babel/types&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> visitor <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function">ArrowFunction</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        path<span class="token punctuation">.</span><span class="token function">replaceWith</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">FunctionDeclaration</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> params<span class="token punctuation">,</span> body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>å¯¹ç»†èŠ‚æ„Ÿå…´è¶£çš„å¯ä»¥ç¿»ç¿»æºç https://github.com/babel/babel/tree/master/packages/babel-traverseã€‚</p> <h3 id="generate-ä»£ç ç”Ÿæˆ"><a href="#generate-ä»£ç ç”Ÿæˆ" aria-hidden="true" class="header-anchor">#</a> Generate(ä»£ç ç”Ÿæˆ)</h3> <p>ç»è¿‡ä¸Šé¢ä¸¤ä¸ªé˜¶æ®µï¼Œéœ€è¦è½¬è¯‘çš„ä»£ç å·²ç»ç»è¿‡è½¬æ¢ï¼Œç”Ÿæˆæ–°çš„ AST äº†ï¼Œæœ€åä¸€ä¸ªé˜¶æ®µç†æ‰€åº”å½“å°±æ˜¯æ ¹æ®è¿™ä¸ª AST æ¥è¾“å‡ºä»£ç ã€‚</p> <p>Babel æ˜¯é€šè¿‡ https://github.com/babel/babel/tree/master/packages/babel-generator æ¥å®Œæˆçš„ã€‚å½“ç„¶ï¼Œä¹Ÿæ˜¯æ·±åº¦ä¼˜å…ˆéå†ã€‚</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Generator</span> <span class="token keyword">extends</span> <span class="token class-name">Printer</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">ast<span class="token punctuation">,</span> opts <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> code</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> format <span class="token operator">=</span> <span class="token function">normalizeOptions</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> opts<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> map <span class="token operator">=</span> opts<span class="token punctuation">.</span>sourceMaps <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">SourceMap</span><span class="token punctuation">(</span>opts<span class="token punctuation">,</span> code<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>format<span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>ast <span class="token operator">=</span> ast<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  ast<span class="token punctuation">:</span> Object<span class="token punctuation">;</span>
  <span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>ast<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>ç»è¿‡è¿™ä¸‰ä¸ªé˜¶æ®µï¼Œä»£ç å°±è¢« Babel è½¬è¯‘æˆåŠŸäº†ã€‚</p> <p>ä»»é‡è€Œé“è¿œ... æƒ³çœŸæ­£æŒæ¡ Babel è¿˜æœ‰å¾ˆé•¿çš„è·¯...</p> <h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" aria-hidden="true" class="header-anchor">#</a> å‚è€ƒé“¾æ¥</h2> <ul><li><a href="https://babel.docschina.org/" target="_blank" rel="noopener noreferrer">Babel<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://zhuanlan.zhihu.com/p/27289600" target="_blank" rel="noopener noreferrer">Babelæ˜¯å¦‚ä½•è¯»æ‡‚JSä»£ç çš„<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/plugin-handbook.md#toc-stages-of-babel" target="_blank" rel="noopener noreferrer">Babel æ’ä»¶æ‰‹å†Œ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/accumulate/JS/A003.html" class="prev">
          Express çš„ä½¿ç”¨
        </a></span> <span class="next"><a href="/accumulate/JS/A005.html">
          javascriptä¸­çš„å…­ç§ç»§æ‰¿æ–¹å¼
        </a>
        â†’
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.ddf169d8.js" defer></script><script src="/assets/js/10.cf1bc230.js" defer></script>
  </body>
</html>
